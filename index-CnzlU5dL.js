import{c as le,p as ue}from"./index-DBAZtN9V.js";function pe(o,c){for(var i=0;i<c.length;i++){const s=c[i];if(typeof s!="string"&&!Array.isArray(s)){for(const f in s)if(f!=="default"&&!(f in o)){const p=Object.getOwnPropertyDescriptor(s,f);p&&Object.defineProperty(o,f,p.get?p:{enumerable:!0,get:()=>s[f]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}var he={exports:{}};(function(o){var c=function(i){var s=Object.prototype,f=s.hasOwnProperty,p=Object.defineProperty||function(t,e,r){t[e]=r.value},h,g=typeof Symbol=="function"?Symbol:{},L=g.iterator||"@@iterator",N=g.asyncIterator||"@@asyncIterator",k=g.toStringTag||"@@toStringTag";function b(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{b({},"")}catch{b=function(e,r,a){return e[r]=a}}function U(t,e,r,a){var n=e&&e.prototype instanceof m?e:m,u=Object.create(n.prototype),v=new x(a||[]);return p(u,"_invoke",{value:ce(t,r,v)}),u}i.wrap=U;function _(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(a){return{type:"throw",arg:a}}}var R="suspendedStart",D="suspendedYield",B="executing",O="completed",l={};function m(){}function d(){}function E(){}var j={};b(j,L,function(){return this});var C=Object.getPrototypeOf,M=C&&C(C(Y([])));M&&M!==s&&f.call(M,L)&&(j=M);var S=E.prototype=m.prototype=Object.create(j);d.prototype=E,p(S,"constructor",{value:E,configurable:!0}),p(E,"constructor",{value:d,configurable:!0}),d.displayName=b(E,k,"GeneratorFunction");function Z(t){["next","throw","return"].forEach(function(e){b(t,e,function(r){return this._invoke(e,r)})})}i.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===d||(e.displayName||e.name)==="GeneratorFunction":!1},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,b(t,k,"GeneratorFunction")),t.prototype=Object.create(S),t},i.awrap=function(t){return{__await:t}};function W(t,e){function r(u,v,w,F){var y=_(t[u],t,v);if(y.type==="throw")F(y.arg);else{var q=y.arg,A=q.value;return A&&typeof A=="object"&&f.call(A,"__await")?e.resolve(A.__await).then(function($){r("next",$,w,F)},function($){r("throw",$,w,F)}):e.resolve(A).then(function($){q.value=$,w(q)},function($){return r("throw",$,w,F)})}}var a;function n(u,v){function w(){return new e(function(F,y){r(u,v,F,y)})}return a=a?a.then(w,w):w()}p(this,"_invoke",{value:n})}Z(W.prototype),b(W.prototype,N,function(){return this}),i.AsyncIterator=W,i.async=function(t,e,r,a,n){n===void 0&&(n=Promise);var u=new W(U(t,e,r,a),n);return i.isGeneratorFunction(e)?u:u.next().then(function(v){return v.done?v.value:u.next()})};function ce(t,e,r){var a=R;return function(u,v){if(a===B)throw new Error("Generator is already running");if(a===O){if(u==="throw")throw v;return Q()}for(r.method=u,r.arg=v;;){var w=r.delegate;if(w){var F=K(w,r);if(F){if(F===l)continue;return F}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(a===R)throw a=O,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);a=B;var y=_(t,e,r);if(y.type==="normal"){if(a=r.done?O:D,y.arg===l)continue;return{value:y.arg,done:r.done}}else y.type==="throw"&&(a=O,r.method="throw",r.arg=y.arg)}}}function K(t,e){var r=e.method,a=t.iterator[r];if(a===h)return e.delegate=null,r==="throw"&&t.iterator.return&&(e.method="return",e.arg=h,K(t,e),e.method==="throw")||r!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var n=_(a,t.iterator,e.arg);if(n.type==="throw")return e.method="throw",e.arg=n.arg,e.delegate=null,l;var u=n.arg;if(!u)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l;if(u.done)e[t.resultName]=u.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=h);else return u;return e.delegate=null,l}Z(S),b(S,k,"Generator"),b(S,L,function(){return this}),b(S,"toString",function(){return"[object Generator]"});function fe(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(fe,this),this.reset(!0)}i.keys=function(t){var e=Object(t),r=[];for(var a in e)r.push(a);return r.reverse(),function n(){for(;r.length;){var u=r.pop();if(u in e)return n.value=u,n.done=!1,n}return n.done=!0,n}};function Y(t){if(t){var e=t[L];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(f.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=h,n.done=!0,n};return a.next=a}}return{next:Q}}i.values=Y;function Q(){return{value:h,done:!0}}return x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(I),!t)for(var e in this)e.charAt(0)==="t"&&f.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=h)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(F,y){return u.type="throw",u.arg=t,e.next=F,y&&(e.method="next",e.arg=h),!!y}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],u=n.completion;if(n.tryLoc==="root")return r("end");if(n.tryLoc<=this.prev){var v=f.call(n,"catchLoc"),w=f.call(n,"finallyLoc");if(v&&w){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(v){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else if(w){if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&f.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&(t==="break"||t==="continue")&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var u=n?n.completion:{};return u.type=t,u.arg=e,n?(this.method="next",this.next=n.finallyLoc,l):this.complete(u)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var a=r.completion;if(a.type==="throw"){var n=a.arg;I(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:Y(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=h),l}},i}(o.exports);try{regeneratorRuntime=c}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=c:Function("r","regeneratorRuntime = r")(c)}})(he);var me={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let H=!1,oe=()=>{};const de=o=>{H=o},ge=o=>{oe=o},ve=(o,c)=>{oe({type:o,message:c}),H&&console.log(`[${o}] ${c}`)};var ne={logging:H,setLogging:de,setCustomLogger:ge,log:ve};let G=0,z=0;const X=o=>{const[c,i,s]=o.split(":");return parseFloat(c)*60*60+parseFloat(i)*60+parseFloat(s)};var we=(o,c)=>{if(typeof o=="string")if(o.startsWith("  Duration")){const i=o.split(", ")[0].split(": ")[1],s=X(i);c({duration:s,ratio:z}),(G===0||G>s)&&(G=s)}else if(o.startsWith("frame")||o.startsWith("size")){const i=o.split("time=")[1].split(" ")[0],s=X(i);z=s/G,c({ratio:z,time:s})}else o.startsWith("video:")&&(c({ratio:1}),G=0)},ye=(o,c)=>{const i=o._malloc(c.length*Uint32Array.BYTES_PER_ELEMENT);return c.forEach((s,f)=>{const p=o._malloc(s.length+1);o.writeAsciiToMemory(s,p),o.setValue(i+Uint32Array.BYTES_PER_ELEMENT*f,p,"i32")}),[c.length,i]},ie={exports:{}};(function(o,c){(function(i,s){o.exports=s()})(le,function(){function i(){var s=arguments.length;if(s===0)throw new Error("resolveUrl requires at least one argument; got none.");var f=document.createElement("base");if(f.href=arguments[0],s===1)return f.href;var p=document.getElementsByTagName("head")[0];p.insertBefore(f,p.firstChild);for(var h=document.createElement("a"),g,L=1;L<s;L++)h.href=arguments[L],g=h.href,f.href=g;return p.removeChild(f),g}return i})})(ie);var J=ie.exports;const be="@ffmpeg/ffmpeg",Ee="0.9.8",Le="FFmpeg WebAssembly version",Fe="src/index.js",je="src/index.d.ts",$e={example:"examples"},Pe={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},Oe={"./src/node/index.js":"./src/browser/index.js"},Se={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},ke=["ffmpeg","WebAssembly","video"],_e="Jerome Wu <jeromewus@gmail.com>",Ce="MIT",Ae={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},Ge={node:">=12.16.1"},Te="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Ne={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},Ue={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.9.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"},ae={name:be,version:Ee,description:Le,main:Fe,types:je,directories:$e,scripts:Pe,browser:Oe,repository:Se,keywords:ke,author:_e,license:Ce,bugs:Ae,engines:Ge,homepage:Te,dependencies:Ne,devDependencies:Ue};var Re={};const Be=J,{devDependencies:Me}=ae;var We={corePath:typeof ue<"u"&&Re.FFMPEG_ENV==="development"?Be("/node_modules/@ffmpeg/core/dist/ffmpeg-core.js"):`https://unpkg.com/@ffmpeg/core@${Me["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const De=J,{log:T}=ne,V=async(o,c)=>{T("info",`fetch ${o}`);const i=await(await fetch(o)).arrayBuffer();T("info",`${o} file size = ${i.byteLength} bytes`);const s=new Blob([i],{type:c}),f=URL.createObjectURL(s);return T("info",`${o} blob URL = ${f}`),f};var Ie=async({corePath:o})=>{if(typeof o!="string")throw Error("corePath should be a string!");const c=De(o),i=await V(c,"application/javascript"),s=await V(c.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),f=await V(c.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(p=>{const h=document.createElement("script"),g=()=>{h.removeEventListener("load",g),T("info","ffmpeg-core.js script loaded"),p({createFFmpegCore,corePath:i,wasmPath:s,workerPath:f})};h.src=i,h.type="text/javascript",h.addEventListener("load",g),document.getElementsByTagName("head")[0].appendChild(h)}):(T("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:i,wasmPath:s,workerPath:f}))};const xe=J,Ye=o=>new Promise((c,i)=>{const s=new FileReader;s.onload=()=>{c(s.result)},s.onerror=({target:{error:{code:f}}})=>{i(Error(`File could not be read! Code=${f}`))},s.readAsArrayBuffer(o)});var qe=async o=>{let c=o;return typeof o>"u"?new Uint8Array:(typeof o=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?c=atob(o.split(",")[1]).split("").map(i=>i.charCodeAt(0)):c=await(await fetch(xe(o))).arrayBuffer():(o instanceof File||o instanceof Blob)&&(c=await Ye(o)),new Uint8Array(c))};const ze=We,Ve=Ie,He=qe;var se={defaultOptions:ze,getCreateFFmpegCore:Ve,fetchFile:He};const{defaultArgs:Je,baseOptions:Ze}=me,{setLogging:ee,setCustomLogger:te,log:P}=ne,Ke=we,Qe=ye,{defaultOptions:Xe,getCreateFFmpegCore:et}=se,{version:tt}=ae,re=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var rt=(o={})=>{const{log:c,logger:i,progress:s,...f}={...Ze,...Xe,...o};let p=null,h=null,g=null,L=!1,N=s;const k=l=>{l==="FFMPEG_END"&&g!==null&&(g(),g=null,L=!1)},b=({type:l,message:m})=>{P(l,m),Ke(m,N),k(m)},U=async()=>{if(P("info","load ffmpeg-core"),p===null){P("info","loading ffmpeg-core");const{createFFmpegCore:l,corePath:m,workerPath:d,wasmPath:E}=await et(f);p=await l({mainScriptUrlOrBlob:m,printErr:j=>b({type:"fferr",message:j}),print:j=>b({type:"ffout",message:j}),locateFile:(j,C)=>{if(typeof window<"u"){if(typeof E<"u"&&j.endsWith("ffmpeg-core.wasm"))return E;if(typeof d<"u"&&j.endsWith("ffmpeg-core.worker.js"))return d}return C+j}}),h=p.cwrap("proxy_main","number",["number","number"]),P("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},_=()=>p!==null,R=(...l)=>{if(P("info",`run ffmpeg command: ${l.join(" ")}`),p===null)throw re;if(L)throw Error("ffmpeg.wasm can only run one command at a time");return L=!0,new Promise(m=>{const d=[...Je,...l].filter(E=>E.length!==0);g=m,h(...Qe(p,d))})},D=(l,...m)=>{if(P("info",`run FS.${l} ${m.map(d=>typeof d=="string"?d:`<${d.length} bytes binary file>`).join(" ")}`),p===null)throw re;{let d=null;try{d=p.FS[l](...m)}catch{throw Error(l==="readdir"?`ffmpeg.FS('readdir', '${m[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:l==="readFile"?`ffmpeg.FS('readFile', '${m[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return d}},B=l=>{N=l},O=l=>{te(l)};return ee(c),te(i),P("info",`use ffmpeg.wasm v${tt}`),{setProgress:B,setLogger:O,setLogging:ee,load:U,isLoaded:_,run:R,FS:D}};const ot=rt,{fetchFile:nt}=se;var it={createFFmpeg:ot,fetchFile:nt};const st=pe({__proto__:null},[it]);export{st as i};
//# sourceMappingURL=index-CnzlU5dL.js.map
